# 操作系统

##  1. 概述

### 1.1 目标和使用

操作系统（Operating System，简称OS）是计算机系统中的一种系统软件，它是控制和管理计算机硬件与应用软件之间交互的核心程序。是硬件和软件的中间层。

操作系统能合理组织计算机工作流程，提高计算机工作效率，是管理计算机硬件资源与软件资源的程序集合。

常见操作系统：

- Windows
- Ios：苹果公司的移动操作系统
- Macos：苹果公司的桌面操作系统
- Linux
- Android：谷歌公司开发的手机操作系统，工作范围已经超出了手机的范围，内核是 Linux
- Unix：操作的东西是计算机文化性的东西
- VxWorks：实时嵌入式操作系统，具有速度快、体积小的特点
- FreeBSD：主要运行服务器，具有速度快、稳定度高的特点
- DOS：只能操作一个程序

操作系统的目标：

- 方便性
- 有效性
- 可扩充性
- 开放性

操作系统的作用：

- 用户与计算机硬件系统之间的接口
  - 命令方式（UNIX、DOS命令）
  - 系统调用方式（API）
  - GUI方式（Windows、LINUX）
- 计算机系统资源的管理者
  - 处理机管理、存储器管理、I/O设别管理、文件管理
- 实现对计算机资源的抽象
  - 裸机：无软件的计算机系统
  - 虚拟机：覆盖了软件的机器，向用户提供一个对硬件操作的抽象模型

### 1.2 操作系统的发展过程

1. 无操作系统的计算机系统
   + 一次只能执行一个程序
2. 单道批处理系统
3. 多道批处理系统
4. 分时系统
   + 在一台主机上连接了多个嗲有显示器和键盘的终端，同时允许多个用户共享主机中的资源，每个用户都可以通过自己的终端以交互方式使用计算机。
   + 特征：多路性、独立性、及时性、交互性
5. 实时系统
   + 系统能及时响应外部事件的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致地运行。
6. 微机操作系统
   1. 单用户单任务
   2. 单用户多任务
   3. 多用户多任务
7. 嵌入式操作系统
   + 嵌入式系统：为了完成某个特定功能而设计地系统，或是有附加机制的系统，或是其他部分的计算机硬件与软件的结合体。
   + 嵌入式 OS：用于嵌入式系统的OS
8. 网络操作系统
   + 在计算机网络环境下对网络资源进行管理和控制，实现数据通信及对网络资源的共享，为用户提供与网络资源接口的一组软件和规程的集合。
   + 特征：硬件独立性、接口一致性、资源透明性、系统可靠性、执行并行性
9. 分布式操作系统
   + 分布式系统：基于软件实现的一种多处理机系统，是多个处理及通过通信线路互连而构成的松耦合系统。
   + 分布式 OS：配置在分布式系上的公用 OS

### 1.3 操作系统的基本特征

- 并发（Concurrence）

  并发性：两个或多个事件在同一时间间隔内发生（食堂并发用餐人数为 12 人）

  并行性：两个或多个事件在同一时刻发生（食堂最多并行 3 人打参）

  引入进程（任务）：动态、并发

- 共享（Sharing）

  系统中的资源可供内存中多个并发执行的进程共同使用

- 虚拟（Virtual）

  时分复用技术：虚拟处理机、虚拟设备

  空分复用技术：虚拟存储

- 异步（Asynchronism）

  进程的异步性：进程是以人们不可预知的速度向前推进的

### 1.4 操作系统的硬件运行环境

- 引导程序：位于固件
- 指令：CPU执行
- 事件：硬件中断或软件中断引起
- 执行程序：位于内存
- 程序：位于外存

操作系统内核：

+ 常驻内存，通常与硬件紧密相关
+ 支撑功能：中断处理、时钟管理、原语操作
+ 资源管理功能：进程管理、存储器管理、设备管理

处理机的双重工作模式：

- 内核态（管态、系统态）：执行包括特权指令在内的一切指令
- 用户态（目态）：不能执行特权指令

特权指令：在内核态下运行的指令

- 不仅能访问用户空间，还能访问系统空间

非特权指令：在用户态下运行的指令

- 仅能访问用户空间
- 应用程序所使用的都是非特权指令
- 防止应用成型鼓的运行异常对系统造成破坏



用户态到内核态的切换：

状态位（Mode bit）指示正确的状态：

+ 内核态：0
+ 用户态：1

当中断或错误出现，硬件切换至内核态。



中断与异常

操作系统是中断驱动的，OS 总在等待某个事件的发生，事件总是由中断或异常引起的。

+ 中断（interrupt）：由硬件引起
+ 异常/陷阱（trap）：由软件引起

### 1.5 操作系统的主要功能

处理机管理功能

1. 进程控制

   创建进程、撤销（终止）进程、状态转换

2. 进程同步

   信号量机制

3. 进程通信

   直接通信、间接通信

4. 调度

   作业调度、进程调度



内存管理功能

1. 内存分配和回收

2. 内存保护

   确保每个用户程序仅在自己的内存空间运行

   绝不允许用户程序访问操作系统的程序和数据

3. 地址映射

   逻辑地址转换为物理地址

4. 内存扩充（虚拟存储技术）

   请求调入功能、置换功能



设备管理功能

主要任务：完成 I/O 请求，提高 CPU 和 I/O 设备的利用率。

1. 缓冲管理
2. 设备分配
3. 设备处理



文件管理功能

文件存储空间的管理、目录管理、文件的读/写和保护



操作系统与用户之间的接口

用户接口：

+ 联机用户接口：命令行方式，各种系统都有命令行界面的位置，对于小型的嵌入式系统，命令行界面会和内核绑定，通过内核实现

  常用实现命令行的方式：shell

  两个流行的 shell：bash、zsh

  shell 命令：

  + 内置命令（Shell 内置）
  + 外部命令（是个程序）

  在命令行之下，我们可以自己写一个程序，来组合很多命令一起完成任务，这个程序叫做脚本。

+ 脱机用户接口

+ 图形用户接口：GUI，图形化界面（1995年Windows图形化界面被接受）



程序接口：

+ 系统调用：能完成特定功能的子程序



现代 OS 的新功能

系统安全、网络功能和服务、支持多媒体

### 1.6 操作系统的结构设计





简单结构

也称整体系统结构，是无结构的，是为数众多的一组过程的集合，内部复杂、混乱。



模块化结构

将 OS 按功能划分为若干个模块，并规定号各模块间的接口，称为“模块-接口法”。

优点：提高 OS 设计的正确性、可理解性和易维护性，增强 OS 的可适应性，加速 OS 的开发过程。

大部分现代 OS 采用可加载的内核模块来设计。



分层式结构

操作系统划为若干层，在低层上构建高层。高层仅依赖于紧邻它的低层。

底层（0层）为硬件；最高层（N层）为用户层。

优点：易保证系统的准确性、系统的易维护性和可扩充性。

缺点：效率低



微内核结构

足够小的内核、应用“机制与策略分离”原理、基于客户/服务器模式、采用面向对象技术。

基本功能：进程管理、低级存储器管理、中断和陷入处理



外核结构

内核不提供传统 OS 中的进程、虚拟存储器等抽象，而是专注于物理资源的隔离（保护）与复用。

### 1.7 系统调用

System Calls（系统调用），又叫 API 接口，计算机与设计人员的接口，一个系统的编程接口。应用程序请求 OS 内核完成某功能时的一种过程调用。

目的：使应用程序可以通过它间接调用 OS 内核中的相关过程，取得相应的服务。

三个重要的 API

+ Win32 API for Windows
+ POSIX API for POSIX-based systems
+ Java API for the Java virtual machine

系统调用类型： 

+ 文件操作类
+ 进程通信类
+ 进程控制类
+ 设备管理类
+ 信息维护类

## 2. 进程描述与进程控制





 
