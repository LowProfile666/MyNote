# 位运算

## 1. 概念定义

位运算是直接对整数在内存中的二进制位进行的运算。由于计算机内部就是以二进制来存储数据，位运算是相当快的。

基本的位运算共 6 种，分别为按位与、按位或、按位异或、按位取反、左移和右移。

### 0）位运算符

|   名称   | 符号 |   示例   |
| :------: | :--: | :------: |
|  按位与  | `&`  | `a & b`  |
|  按位或  | `|`  | `a | b`  |
| 按位异或 | `^`  | `a ^ b`  |
| 按位取反 | `~`  |   `~a`   |
|   左移   | `<<` | `a << b` |
|   右移   | `>>` | `a >> b` |

在 Java 中还有一个右移运算符：`>>>`，它是无符号右移。

### 1）复合赋值位运算

和算术运算符一样，位运算符也可以和赋值运算符组成复合赋值位运算符：

| 符号  |             示例              |
| :---: | :---------------------------: |
| `&=`  |  `a &= b` 等价于 `a = a & b`  |
| `|=`  |  `a |= b` 等价于 `a = a | b`  |
| `^=`  |  `a ^= b` 等价于 `a = a ^ b`  |
| `<<=` | `a <<= b` 等价于 `a = a << b` |
| `>>=` | `a >>= b` 等价于 `a = a >> b` |

### 2）一些应用

**代替乘除运算**

a 是 n 的二倍，b 是 n 的一半：

```java
a = n << 1;
b = n >> 1;
```



求中间值可以这样写：

```java
int m = l+r >> 1;
```



**判断数的奇偶**

```java
if (n & 1 == 1)
    // 奇数
if (n & 1 == 0)
    // 偶数
```



**求出一个数的第 k 个二进制位**

获取 n 的第 k 位二进制数：

```java
int i = (n >> k) & 1;
```



**求 2 的 x 次幂**

```java
int n = 1 << x;
```



**取绝对值**

```java
int abs = (n ^ (n >> 31)) - (n >> 31);
```

`n>>31` 取得 n 的符号，若 n 为正数，`n>>31` 等于 0；若 n 为负数，`n>>31` 等于 -1。

若 n 为正数 `n ^ 0 - 0 = n`, 数不变；若 n 为负数有 `n ^ (-1)`，需要计算 n 和 -1 的补码，然后进行异或运算，结果 n 变号并且为 n 的绝对值减 1，再减去 -1 就是绝对值 。    



**交换两个数的值**

交换了 a 和 b 的值：

```java
a ^= b;
b ^= a;
a ^= b;
```

在 C 语言中以上代码还可以写成一句：

```java
a ^= b ^= a ^= b;
```

但是在 Java 中，这一句代码是不能起到交换变量值的作用的。因为 Java 中复合赋值操作运算符的计算顺序是不确定的。